/*
Title: July 2024 (1.81)
Tags: release notes,visual studio,formatter,php,ai,IntelliPHP,performance
Date: 2024-07-31
*/

# July 2024 (version 1.81)

This release introduces support for PHP 8.4, including new language features such as property hooks and the __PROPERTY__ magic constant. Improvements include enhanced code suggestions, better PHPUnit test discovery, and additional support for PHPStan assertions. The update also brings enhancements to code formatting, such as property alignment within class definitions, along with numerous bug fixes and performance optimizations.

### PHP 8.4 Support (Preview)

This update adds support for the new PHP 8.4 features, including:

- Property hooks, and `__PROPERTY__` magic constant.
- `new` without parentheses.
- Formatting for properties and property hooks.

### Improvements

- Doc Comment generated upon typing `/**` above declaration. This features does not require `formatOnType` enabled anymore.
- Triggering suggestion after typing `$` inside double-quoted strings.
- Triggering suggestion when typing a type hint inside a Doc Comment.
- Initial support for `@phpstan-assert`, `@phpstan-assert-if-true`, `@phpstan-assert-if-false`.
- PhpUnit tests discovered in nested directories, and respecting `prefix` configuration.
- `"source.organizeImports"` code action on save won't remove unused uses, as it might not be desirable. ([#1883](https://community.devsense.com/d/1883))
- Added explicit code actions for `"editor.codeActionsOnSave"` setting:
    - `"source.source.sortImports"`: only sorts uses. The same as `"source.organizeImports"`.
    - `"source.source.sortAndRemoveImports"`: removes unused uses and sorts the rest.
- Recognizes unsealed array shape type ([#587](https://github.com/DEVSENSE/phptools-docs/issues/587))
- Improves initial indexing, postpones discovering test cases after indexing is done.
- Optimizations, memory usage improvements.
- Better `ReflectionClass::getMethods()` type inference.
- Implementing abstract functions adds universal `@inheritDoc` doc comment.
- `Sort uses` code action removes duplicates.
- Adjusted completion sorting for not-imported global types ([#598](https://github.com/DEVSENSE/phptools-docs/issues/598)).
- Magic constants (`__METHOD__`, `__PROPERTY__`, etc.) are checked if they are used in a correct context.
- Diagnostics improvements, fixes for `try`/`finally` control flow and reachability analysis.

### Formatting

#### Align Properties

The formatter now provides `Align Properties` functionality to align the properties within class definitions for improved code presentation and readability. Activate this feature in `Tools | Options` and `Text Editor | PHP | Formatting | Wrapping` and under `Class Properties` enable `Align properties`.

```php
class X
{
    var       $a   = 1;
    public    $bb  = 2;
    protected $ccc = 3;
}
```

### Fixes

- Fixes an issue causing unwanted spaces after formatting `require` and similar statements.
- Fixes an issues when formatting complex expressions in array initializers when using the `php.format.rules.arrayInitializersAlignKeyValuePairs` setting.
- Crash fix when having `@extends parent<>` annotation, with template arguments ([#585](https://github.com/DEVSENSE/phptools-docs/issues/585)).
- Function override check respects `#[ReturnTypeWillChange]` attribute.
- Fixes false unused variable warning about object that is used as an array ([#533](https://github.com/DEVSENSE/phptools-docs/issues/533)).
- Rename and highlight occurences of private fields fixes.
- Fixes missing composer node in Dependencies in the Solution Explorer when other language than English is used. [#2045](https://community.devsense.com/d/2045-dependencies-not-shown-in-visual-studio-with-german-language)
- Stability fixes